import{f as U,r,P as Y,c as x,a as n,K as o,I as i,F as D,a0 as b,u as S,C as G,D as K,$ as u,o as p,G as X,M as _,H as F}from"./index-68b27630.js";import{$ as H,a as z,q as O}from"./jquery-f757e3fd.js";function R(V,w){return new Promise(function(g,v){H.ajax({url:"https://apis.map.qq.com/ws/geocoder/v1/?location="+w+","+V+"&key=J4PBZ-YNE6K-YTSJR-AGXXU-ITI6H-Y4FJV&get_poi=1&output=jsonp&callback=?",type:"get",dataType:"jsonp",success:function(d){d&&d.result&&d.result.address_component?g(d.result.address_component):g({})}})})}const Z={class:"near_box"},Q={id:"first_row"},W={class:"first_row_col2"},ee={class:"noticebar"},te={class:"wanrn_detaill"},ae={class:"classification"},ne={class:"no_data"},ce={__name:"near",setup(V){U(()=>{E(),M(),k("hydrographicStation",v.value)});const w=r(1),g=[{text:"东莞市",value:1},{text:"河源市",value:2},{text:"惠州市",value:3},{text:"深圳市",value:4},{text:"广州市",value:5},{text:"韶关市",value:6}];let v=r("东莞市");const d=e=>{v.value=g.find((t,l)=>l==e),k("hydrographicStation",v.value),m.length>=0&&(console.log("d"),$(0))},J=e=>{const t=new Date(e),l=t.getFullYear(),s=t.getMonth()+1,h=t.getDate(),y=t.getHours(),f=t.getMinutes();return`${l}年${s}月${h}日${y}时${f}分`};let c=Y([]);const M=()=>{H.ajax({url:"http://open.gd121.cn/share/data/getYJ.do?type=json&key=0b9fdc1c7526ae60e6ba59f82453aa3a&logType=warn",method:"get",success:function(e){c.push(e.东莞[0]),c.push(e.河源[0]),c.push(e.惠州[0]),c.push(e.深圳[0]),c.push(e.广州[0]),c.push(e.韶关[0]),c.forEach(t=>{t.publishtime=J(t.publishtime)})}})},N=[{image:"./classIcon/stations.png",text:"水文站",type:"hydrographicStation"},{image:"./classIcon/aqueduct.png",text:"人工渠",type:"artificialCanal"},{image:"./classIcon/river.png",text:"河流",type:"river"},{image:"./classIcon/lake.png",text:"湖泊",type:"lake"},{image:"./classIcon/disaster.png",text:"灾害",type:""},{image:"./classIcon/humanact.png",text:"人文活动",type:"humanisticActivity"},{image:"./classIcon/cityview.png",text:"城市景点",type:""},{image:"./classIcon/heritage.png",text:"文化遗产",type:"culturalHeritage"},{image:"./classIcon/museum.png",text:"博物馆",type:"museum"},{image:"./classIcon/more.png",text:"更多",type:""}];let m=Y([]);const j=r(null),$=(e,t)=>{j.value=t,m.length=0,k(e.type)},C=r(null),I=r(null),q=r(null),B=r(null),E=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{C.value=e.coords.latitude,I.value=e.coords.longitude;const t=C.value,l=I.value;q.value=null,R(l,t).then(s=>{s.street&&(B.value=s)})},e=>{e.value=e.message,C.value=null,I.value=null}):q.value="浏览器不支持地理位置获取"},k=(e,t)=>{B.value;const l={type:e,obj:{district:"",nation:"中国",province:"广东省",city:v.value,street:"",street_number:""}};z.post("https://eslab.dgut.edu.cn/getDongjiangTypeList",O.stringify(l)).then(s=>{s.data.data.forEach(h=>{m.push(h)})}).catch(s=>{console.error(s)})};return(e,t)=>{const l=u("van-dropdown-item"),s=u("van-dropdown-menu"),h=u("van-search"),y=u("van-image"),f=u("van-col"),L=u("van-row"),P=u("van-swipe-item"),A=u("van-swipe");return p(),x("div",Z,[n("div",Q,[n("div",{class:"first_row_col1",onClick:E},[o(s,null,{default:i(()=>[o(l,{modelValue:w.value,"onUpdate:modelValue":t[0]||(t[0]=a=>w.value=a),options:g,onChange:d},null,8,["modelValue"])]),_:1})]),n("div",W,[o(h,{modelValue:e.value,"onUpdate:modelValue":t[1]||(t[1]=a=>e.value=a),placeholder:"搜索附近",onSearch:e.onSearch,onCancel:e.onCancel},null,8,["modelValue","onSearch","onCancel"])])]),n("div",null,[o(L,null,{default:i(()=>[(p(),x(D,null,b(N,(a,T)=>o(f,{id:"each_detail",key:a.text,span:4.8},{default:i(()=>[o(y,{src:a.image,onClick:oe=>$(a,T),fit:"contain",class:X({selected:T==j.value})},null,8,["src","onClick","class"]),n("p",null,_(a.text),1)]),_:2},1032,["span"])),64))]),_:1})]),n("div",ee,[o(A,{class:"wanring-swipe",autoplay:3e3,"indicator-color":"gray"},{default:i(()=>[(p(!0),x(D,null,b(S(c),a=>(p(),F(P,{key:a.city},{default:i(()=>[o(y,{class:"swiperImage",src:"./wind/wind-yellow.png",fit:"contain"}),n("div",te,[n("div",null,_(a.publishtime),1),n("div",null,_(a.city),1),n("div",null,_(a.warn),1)])]),_:2},1024))),128))]),_:1})]),n("div",ae,[(p(!0),x(D,null,b(S(m),a=>(p(),F(L,{key:a.text,class:"each_classify",justify:"center"},{default:i(()=>[o(f,{span:"10"},{default:i(()=>[o(y,{class:"swiperImage",src:"./no-image.png",fit:"cover"})]),_:1}),o(f,{class:"each_classify_detail",span:"14"},{default:i(()=>[n("div",null,_(a.name),1),n("div",null,_(a.intro),1)]),_:2},1024)]),_:2},1024))),128)),G(n("div",ne,"暂无数据",512),[[K,S(m).length==0]])])])}}};export{ce as default};
